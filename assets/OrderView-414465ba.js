import{_ as L,R as S,M as B,r as D,o as a,c as n,a as e,n as h,b as u,w as M,d as r,t as i,F as k,g as x,e as m,i as f,v as w,j as T}from"./index-7bbc4aea.js";import{S as V}from"./sweetalert2.all-f808f091.js";const{VITE_URL:p,VITE_PATH:_}={VITE_PATH:"ssozr",VITE_URL:"https://vue3-course-api.hexschool.io/",BASE_URL:"/vueweek82/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},E={data(){return{paymentOptions:["ATM","信用卡","電信支付"],num:1,cartData:[],dalModal:"",delData:{},delId:"",disabled:!0,addressData:"",address:{city:"",areaName:"",content:"",index:"",areaList:[]},paymentMethod:"",userData:{user:{name:"",email:"",address:"",phone:""},message:""},coupon:{couponJudge:!1,couponNum:""},orderId:"",payModal:""}},components:{RouterLink:S},methods:{nextBtn(){this.num++},preBtn(){this.num--},getCartData(){this.$http.get(`${p}/v2/api/${_}/cart`).then(l=>{this.cartData=l.data.data}).catch(l=>{console.log(l)})},openDelModal(l){this.deldata={},this.delModal.show(),this.delId=l.id,this.delData=l.product},delCart(){this.$http.delete(`${p}/v2/api/${_}/cart/${this.delId}`).then(l=>{console.log(l),this.delData={},this.delId="",this.delModal.hide(),this.getCartData(),V.fire(`${l.data.message}`)}).catch(l=>{console.log(l)})},changeQty(l,t){this.disabled=!0;const N={product_id:t,qty:l};this.$http.put(`${p}/v2/api/${_}/cart/${t}`,{data:N}).then(b=>{console.log(b),V.fire(`${b.data.message}`),this.disabled=!1,this.getCartData()}).catch(b=>{console.log(b)})},getAddressData(){this.$http.get("https://raw.githubusercontent.com/donma/TaiwanAddressCityAreaRoadChineseEnglishJSON/master/AllData.json").then(l=>{this.addressData=l.data,console.log(l),console.log(this.addressData)}).catch(l=>{console.log(l)})},disabledBtn(){this.disabled=!1},city(){console.log(this.address.city),this.address.areaName="";const l=this.addressData.findIndex(t=>t.CityName===this.address.city);this.address.index=l,this.address.areaList={...this.addressData[l].AreaList}},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼"},couponBtn(){const l={code:this.coupon.couponNum};this.$http.post(`${p}/v2/api/${_}/coupon`,{data:l}).then(t=>{console.log(t),this.coupon.couponJudge=t.data.success,V.fire(`${t.data.message}`)}).catch(t=>{console.log(t)})},couponBtnDel(){this.coupon.couponJudge=!1},onSubmit(){this.userData.user.address=`${this.address.city}${this.address.areaName}${this.address.content}`;const l={user:{name:this.userData.user.name,email:this.userData.user.email,tel:this.userData.user.phone,address:this.userData.user.address},message:this.userData.message};this.$http.post(`${p}/v2/api/${_}/order`,{data:l}).then(t=>{console.log(t),this.orderId=t.data.orderId,this.payModal.show()}).catch(t=>{console.log(t)})},pay(){this.$http.post(`${p}/v2/api/${_}/pay/${this.orderId}`).then(l=>{console.log(l),this.payModal.hide(),V.fire(`${l.data.message}`),this.num++}).catch(l=>{console.log(l)})}},mounted(){this.getCartData(),this.delModal=new B(this.$refs.delModal),this.getAddressData(),this.payModal=new B(this.$refs.payModal)}},R={class:"container-fuli"},J={class:"row"},q={class:"order-progress pt-4"},O=e("li",{class:"active"},"訂單確認",-1),P={class:"container mb-15"},j={class:"row"},z={key:0,class:"row"},F=e("h2",{class:"text-center"},"訂單確認",-1),H={class:"row"},Q={class:"table align-middle"},W=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col"},"課程名稱"),e("th",{scope:"col"},"授課老師"),e("th",{scope:"col"},"總課程數"),e("th",{scope:"col"},"購買數量"),e("th",{scope:"col"},"價格"),e("th")])],-1),G={class:"dropdown"},K=["disabled"],X={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Y=["onClick"],Z=["onClick"],$={class:"text-center"},ee=e("td",null,null,-1),te=e("td",null,null,-1),se=e("td",null,null,-1),oe=e("td",null,null,-1),le=e("td",null,null,-1),ae={class:"align-bottom"},ne={class:"border-bottom border-primary border-3 mb-0"},de={class:"ms-1"},ie={class:"modal",tabindex:"-1",ref:"delModal"},ce={class:"modal-dialog"},re={class:"modal-content"},ue={class:"modal-header"},me={key:0,class:"modal-title"},he=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pe=e("div",{class:"modal-body"},[e("p",null,"確定移出購物車?")],-1),_e={class:"modal-footer"},be=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),ye={key:1,class:"row"},ve={class:"mb-3 col-md-6"},ge={for:"name",class:"form-label"},fe={key:0,class:"text-danger"},De={class:"mb-3 col-md-6"},ke={for:"email",class:"form-label"},xe={key:0,class:"text-danger"},Ve={class:"mb-3 col-md-6"},Ce={for:"phone",class:"form-label"},Me={key:0,class:"text-danger"},we={class:"mb-3 col-md-6"},Ne={for:"payment",class:"form-label"},Be={key:0,class:"text-danger"},Te=e("option",{value:"信用卡"},"信用卡",-1),Ae=e("option",{value:"ATM"},"ATM",-1),Ie=e("option",{value:"電信繳費"},"電信繳費",-1),Ue=[Te,Ae,Ie],Le={class:"input-group mb-3"},Se={style:{width:"100%"},for:"地址",class:"form-label"},Ee={key:0,class:"text-danger"},Re={key:0,value:""},Je=["value"],qe=["disabled"],Oe={key:0,value:""},Pe=["value"],je={class:"input-group mb-3"},ze=e("span",{class:"input-group-text"},"留言區",-1),Fe={class:"col-md-8"},He=e("label",{for:"coupon",class:"mb-3"},"優惠券:",-1),Qe={class:"input-group"},We=["disabled"],Ge=["disabled"],Ke={key:0},Xe={key:1},Ye={class:"text-end d-flex justify-content-center col-md-4"},Ze={class:"d-flex align-items-end"},$e={key:0,class:"border-bottom border-primary border-3 mb-0"},et={class:"ms-1"},tt={key:1,class:"border-bottom border-primary border-3 mb-0"},st={class:"ms-1"},ot={class:"text-center mt-6"},lt=["disabled"],at={key:0,class:"row"},nt=e("h2",{class:"text-center"},"課程購買完成",-1),dt=e("div",{class:"d-flex justify-content-center"},[e("ul",null,[e("li",null,"客服人員將會在三天內與您電話連絡"),e("li",null,"若有任何問題，皆可連絡客服")])],-1),it={class:"modal",tabindex:"-1",id:"payModal",ref:"payModal"},ct={class:"modal-dialog"},rt={class:"modal-content"},ut={class:"modal-header"},mt={class:"modal-title"},ht=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pt=e("div",{class:"modal-body"},[e("h3",null,"資料傳送完成，繼續付款？")],-1),_t={class:"modal-footer"},bt=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function yt(l,t,N,b,s,c){const y=D("v-field"),v=D("error-message"),A=D("v-form"),I=D("RouterLink");return a(),n("div",R,[e("div",J,[e("ul",q,[O,e("li",{class:h({active:s.num>=2})}," 填寫資料",2),e("li",{class:h({active:s.num>=3})},"付款完成",2)])]),e("div",P,[e("div",j,[u(A,{onSubmit:t[17]||(t[17]=d=>c.onSubmit())},{default:M(({errors:d})=>[s.num===1?(a(),n("div",z,[F,e("div",H,[e("table",Q,[W,e("tbody",null,[(a(!0),n(k,null,x(s.cartData.carts,(o,g)=>(a(),n("tr",{key:g,class:"text-center"},[e("td",null,[e("h2",null,i(o.product.title),1)]),e("td",null,i(o.product.unit),1),e("td",null,i(o.product.origin_price*o.qty)+"堂",1),e("td",null,[e("div",G,[e("button",{disabled:s.disabled,class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},i(o.qty),9,K),e("ul",X,[(a(),n(k,null,x(20,(C,U)=>e("li",{key:U},[e("a",{onClick:vt=>c.changeQty(C,o.id),class:"dropdown-item"},i(C),9,Y)])),64))])])]),e("td",null,i(o.total),1),e("td",null,[e("button",{type:"button",class:"btn btn-primary rounded-pill",onClick:C=>c.openDelModal(o)},"刪除",8,Z)])]))),128)),e("tr",$,[ee,te,se,oe,le,e("td",ae,[e("h2",ne,[m("總金額:NT "),e("span",de,i(s.cartData.total),1)])])])])]),e("div",ie,[e("div",ce,[e("div",re,[e("div",ue,[s.delData.title?(a(),n("h5",me,i(s.delData.title),1)):r("",!0),he]),pe,e("div",_e,[be,e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=o=>c.delCart(s.delData.id))},"確認移出")])])])],512)])])):r("",!0),s.num===2?(a(),n("div",ye,[e("div",ve,[e("label",ge,[m("姓名: "),d.姓名?(a(),n("span",fe,i(d.姓名),1)):r("",!0)]),u(y,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":d.姓名}]),placeholder:"請輸入 姓名",rules:"required",modelValue:s.userData.user.name,"onUpdate:modelValue":t[1]||(t[1]=o=>s.userData.user.name=o),onClick:t[2]||(t[2]=o=>c.disabledBtn())},null,8,["class","modelValue"]),u(v,{name:"姓名",class:"invalid-feedback"})]),e("div",De,[e("label",ke,[m("信箱: "),d.email?(a(),n("span",xe,i(d.email),1)):r("",!0)]),u(y,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":d.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.userData.user.email,"onUpdate:modelValue":t[3]||(t[3]=o=>s.userData.user.email=o)},null,8,["class","modelValue"]),u(v,{name:"email",class:"invalid-feedback"})]),e("div",Ve,[e("label",Ce,[m("手機號碼: "),d.電話?(a(),n("span",Me,i(d.電話),1)):r("",!0)]),u(y,{id:"phone",name:"電話",type:"text",class:h(["form-control",{"is-invalid":d.電話}]),placeholder:"0912345678",rules:c.isPhone,modelValue:s.userData.user.phone,"onUpdate:modelValue":t[4]||(t[4]=o=>s.userData.user.phone=o)},null,8,["class","rules","modelValue"]),u(v,{name:"電話",class:"invalid-feedback"})]),e("div",we,[e("label",Ne,[m("付款方式: "),d.付款方式?(a(),n("span",Be,i(d.付款方式),1)):r("",!0)]),u(y,{id:"phone",name:"付款方式",type:"select",class:h(["form-control",{"is-invalid":d.付款方式}]),placeholder:"請選擇",rules:"required",modelValue:s.paymentMethod,"onUpdate:modelValue":t[6]||(t[6]=o=>s.paymentMethod=o)},{default:M(()=>[f(e("select",{class:"form-select",id:"payment","onUpdate:modelValue":t[5]||(t[5]=o=>s.paymentMethod=o)},Ue,512),[[w,s.paymentMethod]])]),_:2},1032,["class","modelValue"]),u(v,{name:"付款方式",class:"invalid-feedback"})]),e("div",Le,[e("label",Se,[m("地址: "),d.地址?(a(),n("span",Ee,i(d.地址),1)):r("",!0)]),f(e("select",{class:"btn btn-outline-secondary",onChange:t[7]||(t[7]=(...o)=>c.city&&c.city(...o)),"onUpdate:modelValue":t[8]||(t[8]=o=>s.address.city=o)},[s.address.city?r("",!0):(a(),n("option",Re,"請選擇")),(a(!0),n(k,null,x(s.addressData,(o,g)=>(a(),n("option",{value:o.CityName,key:g},i(o.CityName),9,Je))),128))],544),[[w,s.address.city]]),f(e("select",{class:"btn btn-outline-secondary",disabled:!s.address.city,"onUpdate:modelValue":t[9]||(t[9]=o=>s.address.areaName=o)},[s.address.areaName?r("",!0):(a(),n("option",Oe,"請選擇")),(a(!0),n(k,null,x(s.address.areaList,(o,g)=>(a(),n("option",{value:o.AreaName,key:g},i(o.AreaName),9,Pe))),128))],8,qe),[[w,s.address.areaName]]),u(y,{id:"地址",name:"地址",type:"text",class:h(["form-control",{"is-invalid":d.地址}]),placeholder:"請輸入 路段 門牌號碼",rules:"required",modelValue:s.address.content,"onUpdate:modelValue":t[10]||(t[10]=o=>s.address.content=o),disabled:!s.address.areaName},null,8,["class","modelValue","disabled"]),u(v,{name:"地址",class:"invalid-feedback"})]),e("div",je,[ze,f(e("textarea",{class:"form-control","aria-label":"With textarea",placeholder:"可以說說自己，或是想告訴我們的","onUpdate:modelValue":t[11]||(t[11]=o=>s.userData.message=o)},null,512),[[T,s.userData.message]])]),e("div",Fe,[He,e("div",Qe,[f(e("input",{id:"coupon",type:"text",class:"form-control",placeholder:"輸入優惠券","onUpdate:modelValue":t[12]||(t[12]=o=>s.coupon.couponNum=o),disabled:s.coupon.couponJudge},null,8,We),[[T,s.coupon.couponNum]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[13]||(t[13]=o=>c.couponBtn()),disabled:s.coupon.couponJudge},[s.coupon.couponJudge?(a(),n("span",Ke,"已套用")):(a(),n("span",Xe,"套用"))],8,Ge),s.coupon.couponJudge?(a(),n("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:t[14]||(t[14]=o=>c.couponBtnDel())},"重設優惠券")):r("",!0)])]),e("div",Ye,[e("div",Ze,[s.coupon.couponJudge?(a(),n("h2",tt,[m("總金額:NT "),e("span",st,i(s.cartData.final_total),1)])):(a(),n("h2",$e,[m("總金額:NT "),e("span",et,i(s.cartData.total),1)]))])])])):r("",!0),e("div",ot,[s.num===2?(a(),n("button",{key:0,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:t[15]||(t[15]=(...o)=>c.preBtn&&c.preBtn(...o))},"上一步")):r("",!0),s.num===1?(a(),n("button",{key:1,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:t[16]||(t[16]=(...o)=>c.nextBtn&&c.nextBtn(...o))},"下一步")):r("",!0),s.num===2?(a(),n("button",{key:2,class:"btn btn-primary rounded-pill me-3",type:"submit",disabled:d["付款方式"]||s.disabled},"送出資料",8,lt)):r("",!0)])]),_:1}),s.num===3?(a(),n("div",at,[nt,dt,u(I,{to:"/"},{default:M(()=>[m("回到首頁")]),_:1})])):r("",!0)]),e("div",it,[e("div",ct,[e("div",rt,[e("div",ut,[e("h5",mt,"金額為: "+i(s.cartData.final_total),1),ht]),pt,e("div",_t,[bt,e("button",{type:"button",class:"btn btn-primary",onClick:t[18]||(t[18]=d=>c.pay())},"立即支付")])])])],512)])])}const Dt=L(E,[["render",yt]]);export{Dt as default};
