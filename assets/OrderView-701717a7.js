import{c as U}from"./cart-387cbdcb.js";import{_ as J,R as L,m as E,M as N,r as w,o as d,c as l,b as t,n as _,d as u,w as C,e as c,t as n,F as p,h as b,f as m,j as M,v as V,u as A}from"./index-3e55d3d1.js";import{S as x}from"./sweetalert2.all-f71783cd.js";const{VITE_URL:y,VITE_PATH:v}={VITE_PATH:"ssozr",VITE_URL:"https://vue3-course-api.hexschool.io/",BASE_URL:"/vueweek82/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},R={data(){return{paymentOptions:["ATM","信用卡","電信支付"],num:1,cartData:[],dalModal:"",delData:{},delId:"",dataModal:"",dataModalJudge:!1,disabled:!0,addressData:"",address:{city:"",areaName:"",content:"",index:"",areaList:[]},paymentMethod:"",userData:{user:{name:"",email:"",address:"",phone:""},message:""},coupon:{couponJudge:!1,couponNum:""},orderId:"",payModal:""}},components:{RouterLink:L},methods:{nextBtn(){this.num++},preBtn(){this.num--},getCartData(){this.$http.get(`${y}/v2/api/${v}/cart`).then(a=>{this.cartData=a.data.data}).catch(a=>{alert(a.data.message).error(a)})},openDelModal(a){this.deldata={},this.delModal.show(),this.delId=a.id,this.delData=a.product},delCart(){this.$http.delete(`${y}/v2/api/${v}/cart/${this.delId}`).then(a=>{this.delData={},this.delId="",this.delModal.hide(),this.getCartData(),this.dataModal.hide(),this.getCartDataPinia(),x.fire(`${a.data.message}`)}).catch(a=>{alert(a.data.message).error(a)})},changeQty(a,e){this.disabled=!0;const B={product_id:e,qty:a};this.$http.put(`${y}/v2/api/${v}/cart/${e}`,{data:B}).then(f=>{x.fire(`${f.data.message}`),this.disabled=!1,this.dataModal.hide(),this.getCartData()}).catch(f=>{alert(f.data.message).error(f)})},getAddressData(){this.$http.get("https://raw.githubusercontent.com/donma/TaiwanAddressCityAreaRoadChineseEnglishJSON/master/AllData.json").then(a=>{this.addressData=a.data}).catch(a=>{alert(a.data.message).error(a)})},disabledBtn(){this.disabled=!1},city(){this.address.areaName="";const a=this.addressData.findIndex(e=>e.CityName===this.address.city);this.address.index=a,this.address.areaList={...this.addressData[a].AreaList}},isPhone(a){return/^(09)[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},couponBtn(){const a={code:this.coupon.couponNum};this.$http.post(`${y}/v2/api/${v}/coupon`,{data:a}).then(e=>{this.coupon.couponJudge=e.data.success,x.fire(`${e.data.message}`)}).catch(e=>{alert(e.data.message).error(e)})},couponBtnDel(){this.coupon.couponJudge=!1},onSubmit(){this.userData.user.address=`${this.address.city}${this.address.areaName}${this.address.content}`;const a={user:{name:this.userData.user.name,email:this.userData.user.email,tel:this.userData.user.phone,address:this.userData.user.address},message:this.userData.message};this.$http.post(`${y}/v2/api/${v}/order`,{data:a}).then(e=>{this.orderId=e.data.orderId,this.payModal.show()}).catch(e=>{alert(e.data.message).error(e)})},pay(){this.$http.post(`${y}/v2/api/${v}/pay/${this.orderId}`).then(a=>{this.payModal.hide(),x.fire(`${a.data.message}`),this.num++}).catch(a=>{alert(a.data.message).error(a)})},openDataModal(a){this.dataModalJudge=!0,this.productData={...a},this.delId=a.id,this.dataModal.show()},formatNumber(a){if(a)return a.toLocaleString()},...E(U,["getCartDataPinia"])},mounted(){this.getCartData(),this.delModal=new N(this.$refs.delModal),this.getAddressData(),this.payModal=new N(this.$refs.payModal),this.dataModal=new N(this.$refs.dataModal)}},q={class:"container-fuli","data-aos":"fade-right"},j={class:"row"},P={class:"order-progress pt-4"},O=t("li",{class:"active"},"訂單確認",-1),Q={class:"container mb-15"},z={class:"row"},F={key:0,class:"row"},H=t("h2",{class:"text-center"},"訂單確認",-1),W={class:"row"},G={class:"table align-middle d-lg-table d-none col-12"},K=t("thead",null,[t("tr",{class:"text-center"},[t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"授課老師"),t("th",{scope:"col"},"總課程數"),t("th",{scope:"col"},"購買數量"),t("th",{scope:"col"},"價格"),t("th")])],-1),X={class:"fs-6 mb-0"},Y={class:"dropdown"},Z={class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},$={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},tt=["onClick"],et=["onClick"],st={class:"text-center"},ot=t("td",null,null,-1),at=t("td",null,null,-1),dt=t("td",null,null,-1),lt=t("td",null,null,-1),nt=t("td",null,null,-1),it={class:"align-bottom"},rt={class:"border-bottom border-primary border-3 mb-0"},ct={class:"ms-1"},ut={class:"row d-lg-none my-15"},mt={class:""},ht={class:"fs-5"},_t={class:"d-flex align-items-center justify-content-between"},pt=["onClick"],bt={class:"text-end"},yt={class:"mb-0 fs-4"},vt={class:"ms-1"},ft={class:"modal",tabindex:"-1",ref:"delModal"},gt={class:"modal-dialog"},Dt={class:"modal-content"},kt={class:"modal-header"},Mt={key:0,class:"modal-title"},wt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ct=t("div",{class:"modal-body"},[t("p",null,"確定移出購物車?")],-1),xt={class:"modal-footer"},Nt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Vt={class:"modal",tabindex:"-1",ref:"dataModal"},Bt={class:"modal-dialog"},Tt={key:0,class:"modal-content"},At={class:"modal-header"},It={class:"modal-title"},St={class:"border-bottom border-3 border-primary"},Ut=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Jt={class:"modal-body"},Lt={class:"p-0"},Et={class:"mb-3"},Rt={class:"d-flex align-items-center justify-content-between"},qt={class:"d-flex align-items-center justify-content-between"},jt={class:"dropdown"},Pt={class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},Ot={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Qt=["onClick"],zt={class:"modal-footer"},Ft=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Ht={key:1,class:"row col-md-6 offset-md-3"},Wt={class:"mb-3 col-md-6"},Gt={for:"name",class:"form-label"},Kt={key:0,class:"text-danger"},Xt={class:"mb-3 col-md-6"},Yt={for:"email",class:"form-label"},Zt={key:0,class:"text-danger"},$t={class:"mb-3 col-md-6"},te={for:"phone",class:"form-label"},ee={key:0,class:"text-danger"},se={class:"mb-3 col-md-6"},oe={for:"payment",class:"form-label"},ae={key:0,class:"text-danger"},de=t("option",{value:"信用卡"},"信用卡",-1),le=t("option",{value:"ATM"},"ATM",-1),ne=t("option",{value:"電信繳費"},"電信繳費",-1),ie=[de,le,ne],re={class:"input-group mb-3"},ce={style:{width:"100%"},for:"地址",class:"form-label"},ue={key:0,class:"text-danger"},me={key:0,value:""},he=["value"],_e=["disabled"],pe={key:0,value:""},be=["value"],ye={class:"input-group mb-3"},ve=t("span",{class:"input-group-text"},"留言區",-1),fe={class:"col-md-8"},ge=t("label",{for:"coupon",class:"mb-3"},"優惠券:",-1),De={class:"input-group"},ke=["disabled"],Me=["disabled"],we={key:0},Ce={key:1},xe={class:"text-end d-flex justify-content-center col-md-4"},Ne={class:"d-flex align-items-end"},Ve={key:0,class:"border-bottom border-primary border-3 mb-0 fs-5"},Be={class:"ms-1"},Te={key:1,class:"border-bottom border-primary border-3 mb-0 fs-5"},Ae={class:"ms-1"},Ie={class:"text-center mt-6 btn-list"},Se=["disabled"],Ue={key:0,class:"row"},Je=t("h2",{class:"text-center"},"課程購買完成",-1),Le=t("div",{class:"d-flex justify-content-center"},[t("ul",null,[t("li",null,"客服人員將會在三天內與您電話連絡"),t("li",null,"若有任何問題，皆可連絡客服")])],-1),Ee={class:"modal",tabindex:"-1",id:"payModal",ref:"payModal"},Re={class:"modal-dialog"},qe={class:"modal-content"},je={class:"modal-header"},Pe={class:"modal-title"},Oe=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Qe=t("div",{class:"modal-body"},[t("h3",null,"資料傳送完成，繼續付款？")],-1),ze={class:"modal-footer"},Fe=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function He(a,e,B,f,o,i){const T=w("RouterLink"),g=w("v-field"),D=w("error-message"),I=w("v-form");return d(),l("div",q,[t("div",j,[t("ul",P,[O,t("li",{class:_({active:o.num>=2})}," 填寫資料",2),t("li",{class:_({active:o.num>=3})},"付款完成",2)])]),t("div",Q,[t("div",z,[u(I,{onSubmit:e[18]||(e[18]=r=>i.onSubmit())},{default:C(({errors:r})=>[o.num===1?(d(),l("div",F,[H,t("div",W,[t("table",G,[K,t("tbody",null,[(d(!0),l(p,null,b(o.cartData.carts,(s,h)=>(d(),l("tr",{key:h,class:"text-center"},[t("td",null,[t("h2",X,n(s.product.title),1)]),t("td",null,n(s.product.unit),1),t("td",null,n(s.product.origin_price*s.qty)+"堂",1),t("td",null,[t("div",Y,[t("button",Z,n(s.qty),1),t("ul",$,[(d(),l(p,null,b(20,(k,S)=>t("li",{key:S},[t("a",{onClick:We=>i.changeQty(k,s.id),class:"dropdown-item"},n(k),9,tt)])),64))])])]),t("td",null,n(i.formatNumber(s.total)),1),t("td",null,[t("button",{type:"button",class:"btn btn-primary rounded-pill",onClick:k=>i.openDelModal(s)},"刪除",8,et)])]))),128)),t("tr",st,[ot,at,dt,lt,nt,t("td",it,[t("h2",rt,[m("總金額:NT "),t("span",ct,n(i.formatNumber(o.cartData.total)),1)])])])])]),t("div",ut,[(d(!0),l(p,null,b(o.cartData.carts,(s,h)=>(d(),l("ul",{key:h,class:"border-bottom pb-3 border-primary"},[t("li",mt,[u(T,{to:`/class/${s.product.id}`},{default:C(()=>[t("h2",ht,n(s.product.title),1)]),_:2},1032,["to"]),t("div",_t,[t("div",null,"課程總價格:"+n(i.formatNumber(s.total)),1),t("button",{type:"button",class:"btn btn-primary",onClick:k=>i.openDataModal(s)},"詳細資料",8,pt)])])]))),128)),t("div",bt,[t("h2",yt,[m(" 總金額:NT "),t("span",vt,n(o.cartData.total),1)])])]),t("div",ft,[t("div",gt,[t("div",Dt,[t("div",kt,[o.delData.title?(d(),l("h5",Mt,n(o.delData.title),1)):c("",!0),wt]),Ct,t("div",xt,[Nt,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=s=>i.delCart(o.delData.id))},"確認移出")])])])],512),t("div",Vt,[t("div",Bt,[o.dataModalJudge?(d(),l("div",Tt,[t("div",At,[t("h5",It,[m("課程名稱: "),t("span",St,n(a.productData.product.title),1)]),Ut]),t("div",Jt,[t("ul",Lt,[t("li",Et,[t("div",Rt,[t("div",null,"總堂數:"+n(a.productData.product.origin_price*a.productData.qty)+"堂",1),t("div",null,"授課老師: "+n(a.productData.product.unit),1)])]),t("li",qt,[t("div",null,"課程總價格:"+n(i.formatNumber(a.productData.total)),1),t("div",jt,[m(" 購買次數: "),t("button",Pt,n(a.productData.qty),1),t("ul",Ot,[(d(),l(p,null,b(20,(s,h)=>t("li",{key:h},[t("a",{onClick:k=>i.changeQty(s,a.productData.id),class:"dropdown-item"},n(s),9,Qt)])),64))])])])])]),t("div",zt,[Ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=s=>i.delCart(a.productData))},"確認移出")])])):c("",!0)])],512)])])):c("",!0),o.num===2?(d(),l("div",Ht,[t("div",Wt,[t("label",Gt,[m("*姓名: "),r.姓名?(d(),l("span",Kt,n(r.姓名),1)):c("",!0)]),u(g,{id:"name",name:"姓名",type:"text",class:_(["form-control",{"is-invalid":r.姓名}]),placeholder:"請輸入 姓名",rules:"required",modelValue:o.userData.user.name,"onUpdate:modelValue":e[2]||(e[2]=s=>o.userData.user.name=s),onClick:e[3]||(e[3]=s=>i.disabledBtn())},null,8,["class","modelValue"]),u(D,{name:"姓名",class:"invalid-feedback"})]),t("div",Xt,[t("label",Yt,[m("*信箱: "),r.email?(d(),l("span",Zt,n(r.email),1)):c("",!0)]),u(g,{id:"email",name:"email",type:"email",class:_(["form-control",{"is-invalid":r.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.userData.user.email,"onUpdate:modelValue":e[4]||(e[4]=s=>o.userData.user.email=s)},null,8,["class","modelValue"]),u(D,{name:"email",class:"invalid-feedback"})]),t("div",$t,[t("label",te,[m("*手機號碼: "),r.電話?(d(),l("span",ee,n(r.電話),1)):c("",!0)]),u(g,{id:"phone",name:"電話",type:"tel",class:_(["form-control",{"is-invalid":r.電話}]),placeholder:"0912345678",rules:i.isPhone,modelValue:o.userData.user.phone,"onUpdate:modelValue":e[5]||(e[5]=s=>o.userData.user.phone=s)},null,8,["class","rules","modelValue"]),u(D,{name:"電話",class:"invalid-feedback"})]),t("div",se,[t("label",oe,[m("付款方式: "),r.付款方式?(d(),l("span",ae,n(r.付款方式),1)):c("",!0)]),u(g,{id:"phone",name:"付款方式",type:"select",class:_(["form-control",{"is-invalid":r.付款方式}]),placeholder:"請選擇",rules:"required",modelValue:o.paymentMethod,"onUpdate:modelValue":e[7]||(e[7]=s=>o.paymentMethod=s)},{default:C(()=>[M(t("select",{class:"form-select",id:"payment","onUpdate:modelValue":e[6]||(e[6]=s=>o.paymentMethod=s)},ie,512),[[V,o.paymentMethod]])]),_:2},1032,["class","modelValue"]),u(D,{name:"付款方式",class:"invalid-feedback"})]),t("div",re,[t("label",ce,[m("*地址: "),r.地址?(d(),l("span",ue,n(r.地址),1)):c("",!0)]),M(t("select",{class:"btn btn-outline-secondary",onChange:e[8]||(e[8]=(...s)=>i.city&&i.city(...s)),"onUpdate:modelValue":e[9]||(e[9]=s=>o.address.city=s)},[o.address.city?c("",!0):(d(),l("option",me,"請選擇")),(d(!0),l(p,null,b(o.addressData,(s,h)=>(d(),l("option",{value:s.CityName,key:h},n(s.CityName),9,he))),128))],544),[[V,o.address.city]]),M(t("select",{class:"btn btn-outline-secondary",disabled:!o.address.city,"onUpdate:modelValue":e[10]||(e[10]=s=>o.address.areaName=s)},[o.address.areaName?c("",!0):(d(),l("option",pe,"請選擇")),(d(!0),l(p,null,b(o.address.areaList,(s,h)=>(d(),l("option",{value:s.AreaName,key:h},n(s.AreaName),9,be))),128))],8,_e),[[V,o.address.areaName]]),u(g,{id:"地址",name:"地址",type:"text",class:_(["form-control",{"is-invalid":r.地址}]),placeholder:"請輸入 路段 門牌號碼",rules:"required",modelValue:o.address.content,"onUpdate:modelValue":e[11]||(e[11]=s=>o.address.content=s),disabled:!o.address.areaName},null,8,["class","modelValue","disabled"]),u(D,{name:"地址",class:"invalid-feedback"})]),t("div",ye,[ve,M(t("textarea",{class:"form-control","aria-label":"With textarea",placeholder:"可以說說自己，或是想告訴我們的","onUpdate:modelValue":e[12]||(e[12]=s=>o.userData.message=s)},null,512),[[A,o.userData.message]])]),t("div",fe,[ge,t("div",De,[M(t("input",{id:"coupon",type:"text",class:"form-control",placeholder:"輸入優惠券","onUpdate:modelValue":e[13]||(e[13]=s=>o.coupon.couponNum=s),disabled:o.coupon.couponJudge},null,8,ke),[[A,o.coupon.couponNum]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[14]||(e[14]=s=>i.couponBtn()),disabled:o.coupon.couponJudge},[o.coupon.couponJudge?(d(),l("span",we,"已套用")):(d(),l("span",Ce,"套用"))],8,Me),o.coupon.couponJudge?(d(),l("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[15]||(e[15]=s=>i.couponBtnDel())},"重設優惠券")):c("",!0)])]),t("div",xe,[t("div",Ne,[o.coupon.couponJudge?(d(),l("h2",Te,[m("總金額:NT "),t("span",Ae,n(i.formatNumber(o.cartData.final_total)),1)])):(d(),l("h2",Ve,[m("總金額:NT "),t("span",Be,n(i.formatNumber(o.cartData.total)),1)]))])])])):c("",!0),t("div",Ie,[o.num===2?(d(),l("button",{key:0,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:e[16]||(e[16]=(...s)=>i.preBtn&&i.preBtn(...s))},"上一步")):c("",!0),o.num===1?(d(),l("button",{key:1,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:e[17]||(e[17]=(...s)=>i.nextBtn&&i.nextBtn(...s))},"下一步")):c("",!0),o.num===2?(d(),l("button",{key:2,class:"btn btn-primary rounded-pill me-3 test",type:"submit",disabled:r["付款方式"]||o.disabled},"送出資料",8,Se)):c("",!0)])]),_:1}),o.num===3?(d(),l("div",Ue,[Je,Le,u(T,{to:"/"},{default:C(()=>[m("回到首頁")]),_:1})])):c("",!0)]),t("div",Ee,[t("div",Re,[t("div",qe,[t("div",je,[t("h5",Pe,"金額為: "+n(o.cartData.final_total),1),Oe]),Qe,t("div",ze,[Fe,t("button",{type:"button",class:"btn btn-primary",onClick:e[19]||(e[19]=r=>i.pay())},"立即支付")])])])],512)])])}const Ye=J(R,[["render",He]]);export{Ye as default};
