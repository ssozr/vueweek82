import{c as L}from"./cart-7f9f4e6c.js";import{_ as q,R as E,m as R,M as A,r as w,o as l,c as n,b as t,n as p,d as u,w as C,e as c,t as d,F as b,h as y,g as m,j as x,v as V,q as I}from"./index-18b53ae6.js";import{S as M}from"./sweetalert2.all-ad810f41.js";const{VITE_URL:v,VITE_PATH:f}={VITE_PATH:"ssozr",VITE_URL:"https://vue3-course-api.hexschool.io/",BASE_URL:"/vueweek82/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},J={data(){return{paymentOptions:["ATM","信用卡","電信支付"],num:1,cartData:[],dalModal:"",delData:{},delId:"",disabled:!0,addressData:"",address:{city:"",areaName:"",content:"",index:"",areaList:[]},paymentMethod:"",userData:{user:{name:"",email:"",address:"",phone:""},message:""},coupon:{couponJudge:!1,couponNum:""},orderId:"",payModal:""}},components:{RouterLink:E},methods:{nextBtn(){this.num++},preBtn(){this.num--},getCartData(){this.$http.get(`${v}/v2/api/${f}/cart`).then(a=>{this.cartData=a.data.data}).catch(a=>{alert(a.data.message).error(a)})},openDelModal(a){this.deldata={},this.delModal.show(),this.delId=a.id,this.delData=a.product},delCart(){this.$http.delete(`${v}/v2/api/${f}/cart/${this.delId}`).then(a=>{this.delData={},this.delId="",this.delModal.hide(),this.getCartData(),this.getCartDataPinia(),M.fire(`${a.data.message}`)}).catch(a=>{alert(a.data.message).error(a)})},changeQty(a,e){this.disabled=!0;const B={product_id:e,qty:a};this.$http.put(`${v}/v2/api/${f}/cart/${e}`,{data:B}).then(g=>{M.fire(`${g.data.message}`),this.disabled=!1,this.getCartData()}).catch(g=>{alert(g.data.message).error(g)})},getAddressData(){this.$http.get("https://raw.githubusercontent.com/donma/TaiwanAddressCityAreaRoadChineseEnglishJSON/master/AllData.json").then(a=>{this.addressData=a.data}).catch(a=>{alert(a.data.message).error(a)})},disabledBtn(){this.disabled=!1},city(){this.address.areaName="";const a=this.addressData.findIndex(e=>e.CityName===this.address.city);this.address.index=a,this.address.areaList={...this.addressData[a].AreaList}},isPhone(a){return/^(09)[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},couponBtn(){const a={code:this.coupon.couponNum};this.$http.post(`${v}/v2/api/${f}/coupon`,{data:a}).then(e=>{this.coupon.couponJudge=e.data.success,M.fire(`${e.data.message}`)}).catch(e=>{alert(e.data.message).error(e)})},couponBtnDel(){this.coupon.couponJudge=!1},onSubmit(){this.userData.user.address=`${this.address.city}${this.address.areaName}${this.address.content}`;const a={user:{name:this.userData.user.name,email:this.userData.user.email,tel:this.userData.user.phone,address:this.userData.user.address},message:this.userData.message};this.$http.post(`${v}/v2/api/${f}/order`,{data:a}).then(e=>{this.orderId=e.data.orderId,this.payModal.show()}).catch(e=>{alert(e.data.message).error(e)})},pay(){this.$http.post(`${v}/v2/api/${f}/pay/${this.orderId}`).then(a=>{this.payModal.hide(),M.fire(`${a.data.message}`),this.num++}).catch(a=>{alert(a.data.message).error(a)})},formatNumber(a){if(a)return a.toLocaleString()},...R(L,["getCartDataPinia"])},mounted(){this.getCartData(),this.delModal=new A(this.$refs.delModal),this.getAddressData(),this.payModal=new A(this.$refs.payModal)}},j={class:"container-fuli","data-aos":"fade-right"},P={class:"row"},O={class:"order-progress pt-4"},Q=t("li",{class:"active"},"訂單確認",-1),z={class:"container mb-15"},F={class:"row"},H={key:0,class:"row"},W=t("h2",{class:"text-center"},"訂單確認",-1),G={class:"row"},K={class:"table align-middle d-lg-table d-none col-12"},X=t("thead",null,[t("tr",{class:"text-center"},[t("th",{scope:"col"},"課程名稱"),t("th",{scope:"col"},"授課老師"),t("th",{scope:"col"},"總課程數"),t("th",{scope:"col"},"購買數量"),t("th",{scope:"col"},"價格"),t("th")])],-1),Y={class:"fs-6 mb-0"},Z={class:"dropdown"},$={class:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},tt={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},et=["onClick"],st=["onClick"],ot={class:"text-center"},at=t("td",null,null,-1),lt=t("td",null,null,-1),nt=t("td",null,null,-1),dt=t("td",null,null,-1),it=t("td",null,null,-1),rt={class:"align-bottom"},ct={class:"border-bottom border-primary border-3 mb-0 fs-6"},ut={class:"ms-1"},mt={class:"row d-lg-none my-15 justify-content-center"},_t={class:"col-md-8"},ht={class:"d-flex justify-content-between align-items-center mb-3"},pt={class:"fs-5"},bt=["onClick"],yt={class:"d-flex align-items-center justify-content-between"},vt={class:"dropdown"},ft={class:"btn btn-secondary dropdown-toggle py-0",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"},gt={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Dt=["onClick"],kt={class:"text-end"},xt={class:"mb-0 fs-6"},wt={class:"ms-1"},Ct={key:1,class:"row col-md-6 offset-md-3"},Mt={class:"mb-3 col-md-6"},Nt={for:"name",class:"form-label"},Vt={key:0,class:"text-danger"},Bt={class:"mb-3 col-md-6"},Tt={for:"email",class:"form-label"},At={key:0,class:"text-danger"},It={class:"mb-3 col-md-6"},St={for:"phone",class:"form-label"},Ut={key:0,class:"text-danger"},Lt={class:"mb-3 col-md-6"},qt={for:"payment",class:"form-label"},Et={key:0,class:"text-danger"},Rt=t("option",{value:"信用卡"},"信用卡",-1),Jt=t("option",{value:"ATM"},"ATM",-1),jt=t("option",{value:"電信繳費"},"電信繳費",-1),Pt=[Rt,Jt,jt],Ot={class:"input-group mb-3"},Qt={style:{width:"100%"},for:"地址",class:"form-label"},zt={key:0,class:"text-danger"},Ft={key:0,value:""},Ht=["value"],Wt=["disabled"],Gt={key:0,value:""},Kt=["value"],Xt={class:"input-group mb-3"},Yt=t("span",{class:"input-group-text"},"留言區",-1),Zt={class:"col-md-8"},$t=t("label",{for:"coupon",class:"mb-3"},"優惠券:",-1),te={class:"input-group"},ee=["disabled"],se=["disabled"],oe={key:0},ae={key:1},le={class:"text-end d-flex justify-content-center col-md-4 mt-3"},ne={class:"d-flex align-items-end"},de={key:0,class:"border-bottom border-primary border-3 mb-0 fs-5"},ie={class:"ms-1"},re={key:1,class:"border-bottom border-primary border-3 mb-0 fs-5"},ce={class:"ms-1"},ue={class:"text-center mt-6 btn-list"},me=["disabled"],_e={key:0,class:"row"},he=t("h2",{class:"text-center"},"課程購買完成",-1),pe=t("div",{class:"d-flex justify-content-center"},[t("ul",null,[t("li",null,"客服人員將會在三天內與您電話連絡"),t("li",null,"若有任何問題，皆可連絡客服")])],-1),be={class:"text-center"},ye={class:"modal",tabindex:"-1",id:"payModal",ref:"payModal"},ve={class:"modal-dialog"},fe={class:"modal-content"},ge={class:"modal-header"},De={class:"modal-title"},ke=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),xe=t("div",{class:"modal-body"},[t("h3",null,"資料傳送完成，繼續付款？")],-1),we={class:"modal-footer"},Ce=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Me={class:"modal",tabindex:"-1",ref:"delModal"},Ne={class:"modal-dialog"},Ve={class:"modal-content"},Be={class:"modal-header"},Te={key:0,class:"modal-title"},Ae=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ie=t("div",{class:"modal-body"},[t("p",null,"確定移出購物車?")],-1),Se={class:"modal-footer"},Ue=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function Le(a,e,B,g,o,i){const T=w("RouterLink"),D=w("v-field"),k=w("error-message"),S=w("v-form");return l(),n(b,null,[t("div",j,[t("div",P,[t("ul",O,[Q,t("li",{class:p({active:o.num>=2})}," 填寫資料",2),t("li",{class:p({active:o.num>=3})},"付款完成",2)])]),t("div",z,[t("div",F,[u(S,{onSubmit:e[16]||(e[16]=r=>i.onSubmit())},{default:C(({errors:r})=>[o.num===1?(l(),n("div",H,[W,t("div",G,[t("table",K,[X,t("tbody",null,[(l(!0),n(b,null,y(o.cartData.carts,(s,_)=>(l(),n("tr",{key:_,class:"text-center"},[t("td",null,[t("h2",Y,d(s.product.title),1)]),t("td",null,d(s.product.unit),1),t("td",null,d(s.product.origin_price*s.qty)+"堂",1),t("td",null,[t("div",Z,[t("button",$,d(s.qty),1),t("ul",tt,[(l(),n(b,null,y(20,(h,N)=>t("li",{key:N},[t("a",{onClick:U=>i.changeQty(h,s.id),class:"dropdown-item"},d(h),9,et)])),64))])])]),t("td",null,d(i.formatNumber(s.total)),1),t("td",null,[t("button",{type:"button",class:"btn btn-primary rounded-pill",onClick:h=>i.openDelModal(s)},"刪除",8,st)])]))),128)),t("tr",ot,[at,lt,nt,dt,it,t("td",rt,[t("h2",ct,[m("總金額:NT "),t("span",ut,d(i.formatNumber(o.cartData.total)),1)])])])])]),t("div",mt,[t("div",_t,[(l(!0),n(b,null,y(o.cartData.carts,(s,_)=>(l(),n("ul",{key:_,class:"border-bottom pb-3 border-primary"},[t("li",null,[t("div",ht,[u(T,{to:`/class/${s.product.id}`},{default:C(()=>[t("h2",pt,d(s.product.title),1)]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-primary rounded-pill",onClick:h=>i.openDelModal(s)},"刪除",8,bt)]),t("div",yt,[t("div",vt,[m(" 購買次數: "),t("button",ft,d(s.qty),1),t("ul",gt,[(l(),n(b,null,y(20,(h,N)=>t("li",{key:N},[t("a",{onClick:U=>i.changeQty(h,s.id),class:"dropdown-item"},d(h),9,Dt)])),64))])]),t("div",null,"堂數:"+d(s.product.origin_price*s.qty),1),t("div",null,"課程總價格:"+d(i.formatNumber(s.total)),1)])])]))),128)),t("div",kt,[t("h2",xt,[m(" 總金額:NT "),t("span",wt,d(i.formatNumber(o.cartData.total)),1)])])])])])])):c("",!0),o.num===2?(l(),n("div",Ct,[t("div",Mt,[t("label",Nt,[m("*姓名: "),r.姓名?(l(),n("span",Vt,d(r.姓名),1)):c("",!0)]),u(D,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":r.姓名}]),placeholder:"請輸入 姓名",rules:"required",modelValue:o.userData.user.name,"onUpdate:modelValue":e[0]||(e[0]=s=>o.userData.user.name=s),onClick:e[1]||(e[1]=s=>i.disabledBtn())},null,8,["class","modelValue"]),u(k,{name:"姓名",class:"invalid-feedback"})]),t("div",Bt,[t("label",Tt,[m("*信箱: "),r.email?(l(),n("span",At,d(r.email),1)):c("",!0)]),u(D,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":r.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.userData.user.email,"onUpdate:modelValue":e[2]||(e[2]=s=>o.userData.user.email=s)},null,8,["class","modelValue"]),u(k,{name:"email",class:"invalid-feedback"})]),t("div",It,[t("label",St,[m("*手機號碼: "),r.電話?(l(),n("span",Ut,d(r.電話),1)):c("",!0)]),u(D,{id:"phone",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":r.電話}]),placeholder:"0912345678",rules:i.isPhone,modelValue:o.userData.user.phone,"onUpdate:modelValue":e[3]||(e[3]=s=>o.userData.user.phone=s)},null,8,["class","rules","modelValue"]),u(k,{name:"電話",class:"invalid-feedback"})]),t("div",Lt,[t("label",qt,[m("付款方式: "),r.付款方式?(l(),n("span",Et,d(r.付款方式),1)):c("",!0)]),u(D,{id:"phone",name:"付款方式",type:"select",class:p(["form-control",{"is-invalid":r.付款方式}]),placeholder:"請選擇",rules:"required",modelValue:o.paymentMethod,"onUpdate:modelValue":e[5]||(e[5]=s=>o.paymentMethod=s)},{default:C(()=>[x(t("select",{class:"form-select",id:"payment","onUpdate:modelValue":e[4]||(e[4]=s=>o.paymentMethod=s)},Pt,512),[[V,o.paymentMethod]])]),_:2},1032,["class","modelValue"]),u(k,{name:"付款方式",class:"invalid-feedback"})]),t("div",Ot,[t("label",Qt,[m("*地址: "),r.地址?(l(),n("span",zt,d(r.地址),1)):c("",!0)]),x(t("select",{class:"btn btn-outline-secondary",onChange:e[6]||(e[6]=(...s)=>i.city&&i.city(...s)),"onUpdate:modelValue":e[7]||(e[7]=s=>o.address.city=s)},[o.address.city?c("",!0):(l(),n("option",Ft,"請選擇")),(l(!0),n(b,null,y(o.addressData,(s,_)=>(l(),n("option",{value:s.CityName,key:_},d(s.CityName),9,Ht))),128))],544),[[V,o.address.city]]),x(t("select",{class:"btn btn-outline-secondary",disabled:!o.address.city,"onUpdate:modelValue":e[8]||(e[8]=s=>o.address.areaName=s)},[o.address.areaName?c("",!0):(l(),n("option",Gt,"請選擇")),(l(!0),n(b,null,y(o.address.areaList,(s,_)=>(l(),n("option",{value:s.AreaName,key:_},d(s.AreaName),9,Kt))),128))],8,Wt),[[V,o.address.areaName]]),u(D,{id:"地址",name:"地址",type:"text",class:p(["form-control",{"is-invalid":r.地址}]),placeholder:"請輸入 路段 門牌號碼",rules:"required",modelValue:o.address.content,"onUpdate:modelValue":e[9]||(e[9]=s=>o.address.content=s),disabled:!o.address.areaName},null,8,["class","modelValue","disabled"]),u(k,{name:"地址",class:"invalid-feedback"})]),t("div",Xt,[Yt,x(t("textarea",{class:"form-control","aria-label":"With textarea",placeholder:"可以說說自己，或是想告訴我們的","onUpdate:modelValue":e[10]||(e[10]=s=>o.userData.message=s)},null,512),[[I,o.userData.message]])]),t("div",Zt,[$t,t("div",te,[x(t("input",{id:"coupon",type:"text",class:"form-control",placeholder:"輸入優惠券","onUpdate:modelValue":e[11]||(e[11]=s=>o.coupon.couponNum=s),disabled:o.coupon.couponJudge},null,8,ee),[[I,o.coupon.couponNum]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[12]||(e[12]=s=>i.couponBtn()),disabled:o.coupon.couponJudge},[o.coupon.couponJudge?(l(),n("span",oe,"已套用")):(l(),n("span",ae,"套用"))],8,se),o.coupon.couponJudge?(l(),n("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:e[13]||(e[13]=s=>i.couponBtnDel())},"重設優惠券")):c("",!0)])]),t("div",le,[t("div",ne,[o.coupon.couponJudge?(l(),n("h2",re,[m("總金額:NT "),t("span",ce,d(i.formatNumber(o.cartData.final_total)),1)])):(l(),n("h2",de,[m("總金額:NT "),t("span",ie,d(i.formatNumber(o.cartData.total)),1)]))])])])):c("",!0),t("div",ue,[o.num===2?(l(),n("button",{key:0,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:e[14]||(e[14]=(...s)=>i.preBtn&&i.preBtn(...s))},"上一步")):c("",!0),o.num===1?(l(),n("button",{key:1,class:"btn btn-primary rounded-pill me-3",type:"button",onClick:e[15]||(e[15]=(...s)=>i.nextBtn&&i.nextBtn(...s))},"下一步")):c("",!0),o.num===2?(l(),n("button",{key:2,class:"btn btn-primary rounded-pill me-3 test",type:"submit",disabled:r["付款方式"]||o.disabled},"送出資料",8,me)):c("",!0)])]),_:1}),o.num===3?(l(),n("div",_e,[he,pe,t("div",be,[u(T,{to:"/",class:"btn btn-secondary"},{default:C(()=>[m("回到首頁")]),_:1})])])):c("",!0)])])]),t("div",ye,[t("div",ve,[t("div",fe,[t("div",ge,[t("h5",De,"金額為: "+d(o.cartData.final_total),1),ke]),xe,t("div",we,[Ce,t("button",{type:"button",class:"btn btn-primary",onClick:e[17]||(e[17]=r=>i.pay())},"立即支付")])])])],512),t("div",Me,[t("div",Ne,[t("div",Ve,[t("div",Be,[o.delData.title?(l(),n("h5",Te,d(o.delData.title),1)):c("",!0),Ae]),Ie,t("div",Se,[Ue,t("button",{type:"button",class:"btn btn-primary",onClick:e[18]||(e[18]=r=>i.delCart(o.delData.id))},"確認移出")])])])],512)],64)}const Je=q(J,[["render",Le]]);export{Je as default};
